# 데이터베이스의 규모확장

<aside>
💡 데이터베이스의 수평적 확장은 샤딩 이라고도 부름

더 많은 서버를 추가함으로써 성능을 향상시킬 수 있도록 함

</aside>

- 샤딩
    - 대규모 데이터베이스를 샤드라고 부르는 작은 단위로 분할하는 기술을 일걷음
    - 모든 샤드는 같은 스키마를 쓰지만 샤드에 보관되는 데이터 사이에는 중복이 없음

- 샤딩 전략을 구현할 때 고려해야 할 것
    - 가장 중요한 것은 샤딩 키를 어떻게 할지 정하는 것
    - 샤딩 키는 파티션 키라고도 부르는데, 데이터가 어떻게 분산될지 정하는 하나 이상의 칼럼으로 구성함
    - 샤딩 키를 정할 때는 데이터를 고르게 분할 할 수 있도록 하는게 가장 중요함

- 샤딩의 문제
    - 데이터 재 샤딩
        - 어떠한 경우에 필요한가?
            - 데이터가 너무 많아져서 하나의 샤드로는 더 이상 감당하기 어려울때
            - 샤드 간 데이터 분포가 균등하지 못하여 어떤 샤드에 할당된 공간 소모가 다른 샤드에 비해 빨리 진행될 때 (샤드 소진)
        - 어떻게 해결하는가
            - 샤드 키를 계산하는 함수를 변경하고 데이터를 재배치 해야 함
            - 안정 해시 기법을 활용하면 이 문제를 해결할 수 있음
    - 유명인사 문제(핫스팟 키 문제)
        - 특정 샤드에 질의가 집중되어 과부하가 걸리는 문제
        - 어떻게 해결하는가
            - 키 분산 전략 개선
                - 해시 함수 사용
                    - 균등한 키 분포를 위해 해시 함수를 사용하여 요청을 분산시킴
                    - 이는 키가 특정 노드나 리소스에 집중되는 것을 방지함
                - 컨시스턴트 해싱
                    - 컨시스턴트 해싱은 노드 추가나 제거 시 전체 키의 재분배를 최소화하면서도 균일한 데이터 분산을 유지하는 방법
            - 데이터 복제와 샤딩
                - 데이터 복제
                    - 핫스팟 데이터를 여러 노드에 복제하여, 과부하 된 노드에 대한 접근을 분산시키고, 읽기 요청에 대한 가용성과 성능을 향상시킴
                - 데이터 샤딩
                    - 데이터를 여러 파션으로 나누어 각 샤드를 다른 노드에서 관리하게 함으로써 특정 키에 대한 요청이 여러 노드에 분산되도록 함
            - 캐시 레이어 추가
                - 캐시 전략 사용
                    - 메모리 캐시를 사용하여 핫 스팟 데이터를 캐싱함으로써 데이터베이스나 백엔드 시스템에 대한 직접적인 접근을 줄임
                - 캐시 무효화 및 갱신 전략
                    - 적절한 캐시 무효화 및 갱신 전략을 사용하여 캐시된 데이터의 신선도를 유지하면서도핫스팟 문제를 완화함
            - 비율 제한과 큐잉
                - 비율제한
                    - 특정 키나 서비스에 대한 요청 비율을 제한하여 과도한 트래픽을 방지함
                - 요청 큐잉
                    - 과도한 요청을 큐에 넣고 순차적으로 처리함으로써, 핫스팟 키로 인한 시스템 과부하를 방지함
            - 데이터 액세스 패턴 분석
                - 액세스 패턴 모니터링
                    - 시스템의 액세스 패턴을 지속적으로모니터링하고 분석하여 핫스팟 키가 발생하는 조건을 파악함
                - 응용 프로그램 로직 최적화
                    - 데이터 액세스 패턴을 분석한 결과를 바탕으로 애플리케이션 로직을 최적화하여 특정 키에 대한 접근을 분산시키거나 줄임
            
    - 조인과 비정규화
        - 일단 하나의 데이터베이스를 여러 샤드 서버로 쪼개고나면, 여러 샤드에 걸치 데이터를 조인하기가 힘들어짐
        - 이를 해결하는 방법은 데이터베이스를 비정규화하여 하나의 테이블에서 질의가 수행될 있도록 하는 것
