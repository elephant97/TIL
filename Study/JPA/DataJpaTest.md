# @DataJpaTest 어노테이션

### @DataJpaTest란
* Spring Data JPA를 사용하는 애플리케이션의 리포지토리 계층에 대한 테스트를 위해 설계되었음
* 테스트 클래스에 적용하게 되면 Spring Test Context는 JPA 관련 설정만을 로드하여 리포지토리 계층의 테스트 실행을 용이하게 함

### 특징
* **JPA테스트에 최적화된 설정 제공**
  * 테스트에서는 데이터 소스 설정, JPA 엔티티 매니저, 트랜잭션 관리자 등 JPA에 필요한 빈들만 로드함
  * 이를 통해 테스트 실행 시간을 줄여줌
* **인메모리 데이터베이스 사용**
  * 기본적으노 @DataJpaTest는 인메모리 데이터베이스를 사용함
  * 이를통해 실제 데이터베이스에 영양을 주지 않으면서 테스트를 신속하게 수행할 수 있음
* **트랜잭션 관리**
  * 각 테스트 메서드는 기본적으로 트랜잭션 내에서 실행되며, 테스트 완료 후 롤백 됨
  * 이를 통해 테스트 간의 데이터 격리를 보장하며, 테스트가 데이터베이스 상태에 영향을 주지 않도록 함
* **리포지토리 테스트에 초점**
  * @DataJpaTest는 주로 리포지토리 인터페이스의 메서드를 테스트하는데 사용됨
  * 데이터 접근 계층의 코드를 검증하는데 중점을 둠

### 사용법
* @DataJpaTest 어노테이션을 사용하여 리포지토리 메서드가 잘 동작하는지 테스트함
* @Autowired를 통해 Spring Test Context로 부터 리포지토리 인스턴스를 주입받고, 테스트 메서드에서는 저장, 조회 등의 작업을 수행한 후 결과를 검증

### JPA 영속성 컨텍스트의 쿼리 실행 방식
* 영속성 컨텍스트는 flush()가 실행되기 전까지 실행될 쿼리를 가지고 있다가 한번에 쿼리를 실행하도록 설계되어있음
* flush()가 실행되기 전까지 쿼리가 실행되지 않는다는 것은 @Transactional안에서 Rollback되어야 하는 상황이라면 애초에 쿼리가 실행조차 되지 않을 수 있다는 것
* JUnit을 통한 Test실행 시 @Transactoinal가 적용되어있는 로직은 Select를 제외한 모든 쿼리를 Rollback 대상으로 취급함
* 따라서 테스트를 직접 실행해보면 @Transactional 테스트 내부에서의 쿼리는 실행되지 않으므로 출력되지 않는다.
* @DataJpaTest를 사용하는 경우, @SpringBootTest @Transactional 어노테이션을 함께 사용할 경우 Rollback 대상 쿼리는 실행되지 않는다.
* 하지만 위와같은 어노테이션을 사용하더라도 @Rollback(false)을 사용하면 쿼리가 실행되게 된다.
